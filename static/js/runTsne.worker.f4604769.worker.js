!function(t){var r={};function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(r){return t[r]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="/t-sne-visualization-tool/",e(e.s=1)}([function(t,r,e){var n=n||{REVISION:"ALPHA"};!function(t){"use strict";var r=function(t,r){if(!t)throw r||"Assertion failed"},e=function(t,r,e){return t.hasOwnProperty(r)?t[r]:e},n=!1,i=0,s=function t(){if(n)return n=!1,i;var r=2*Math.random()-1,e=2*Math.random()-1,s=r*r+e*e;if(0==s||s>1)return t();var o=Math.sqrt(-2*Math.log(s)/s);return i=e*o,n=!0,r*o},o=function(t,r){return t+s()*r},a=function(t){if("undefined"===typeof t||isNaN(t))return[];if("undefined"===typeof ArrayBuffer){for(var r=new Array(t),e=0;e<t;e++)r[e]=0;return r}return new Float64Array(t)},u=function(t,r,e){for(var n="undefined"!==typeof e,i=[],s=0;s<t;s++){for(var a=[],u=0;u<r;u++)n?a.push(e):a.push(o(0,1e-4));i.push(a)}return i},h=function(t,r){for(var e=t.length,n=0,i=0;i<e;i++){var s=t[i],o=r[i];n+=(s-o)*(s-o)}return n},f=function(t,e,n){var i=Math.sqrt(t.length),s=Math.floor(i);r(s===i,"D should have square number of elements.");for(var o=Math.log(e),u=a(s*s),h=a(s),f=0;f<s;f++){for(var c=-1/0,l=1/0,p=1,d=!1,v=0;!d;){for(var y=0,m=0;m<s;m++){var g=Math.exp(-t[f*s+m]*p);f===m&&(g=0),h[m]=g,y+=g}var S=0;for(m=0;m<s;m++){if(0==y)g=0;else g=h[m]/y;h[m]=g,g>1e-7&&(S-=g*Math.log(g))}S>o?(c=p,l===1/0?p*=2:p=(p+l)/2):(l=p,c===-1/0?p/=2:p=(p+c)/2),v++,Math.abs(S-o)<n&&(d=!0),v>=50&&(d=!0)}for(m=0;m<s;m++)u[f*s+m]=h[m]}var b=a(s*s),x=2*s;for(f=0;f<s;f++)for(m=0;m<s;m++)b[f*s+m]=Math.max((u[f*s+m]+u[m*s+f])/x,1e-100);return b};function c(t){return t>0?1:t<0?-1:0}var l=function(t){t=t||{};this.perplexity=e(t,"perplexity",30),this.dim=e(t,"dim",2),this.epsilon=e(t,"epsilon",10),this.iter=0};l.prototype={initDataRaw:function(t){var e=t.length,n=t[0].length;r(e>0," X is empty? You must have some data!"),r(n>0," X[0] is empty? Where is the data?");var i=function(t){for(var r=t.length,e=a(r*r),n=0;n<r;n++)for(var i=n+1;i<r;i++){var s=h(t[n],t[i]);e[n*r+i]=s,e[i*r+n]=s}return e}(t);this.P=f(i,this.perplexity,1e-4),this.N=e,this.initSolution()},initDataDist:function(t){var e=t.length;r(e>0," X is empty? You must have some data!");for(var n=a(e*e),i=0;i<e;i++)for(var s=i+1;s<e;s++){var o=t[i][s];n[i*e+s]=o,n[s*e+i]=o}this.P=f(n,this.perplexity,1e-4),this.N=e,this.initSolution()},initSolution:function(){this.Y=u(this.N,this.dim),this.gains=u(this.N,this.dim,1),this.ystep=u(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var t=this.N,r=this.costGrad(this.Y),e=r.cost,n=r.grad,i=a(this.dim),s=0;s<t;s++)for(var o=0;o<this.dim;o++){var u=n[s][o],h=this.ystep[s][o],f=this.gains[s][o],l=c(u)===c(h)?.8*f:f+.2;l<.01&&(l=.01),this.gains[s][o]=l;var p=(this.iter<250?.5:.8)*h-this.epsilon*l*n[s][o];this.ystep[s][o]=p,this.Y[s][o]+=p,i[o]+=this.Y[s][o]}for(s=0;s<t;s++)for(o=0;o<this.dim;o++)this.Y[s][o]-=i[o]/t;return e},debugGrad:function(){for(var t=this.N,r=this.costGrad(this.Y),e=(r.cost,r.grad),n=1e-5,i=0;i<t;i++)for(var s=0;s<this.dim;s++){var o=this.Y[i][s];this.Y[i][s]=o+n;var a=this.costGrad(this.Y);this.Y[i][s]=o-n;var u=this.costGrad(this.Y),h=e[i][s],f=(a.cost-u.cost)/(2*n);console.log(i+","+s+": gradcheck analytic: "+h+" vs. numerical: "+f),this.Y[i][s]=o}},costGrad:function(t){for(var r=this.N,e=this.dim,n=this.P,i=this.iter<100?4:1,s=a(r*r),o=0,u=0;u<r;u++)for(var h=u+1;h<r;h++){for(var f=0,c=0;c<e;c++){var l=t[u][c]-t[h][c];f+=l*l}var p=1/(1+f);s[u*r+h]=p,s[h*r+u]=p,o+=2*p}for(var d=r*r,v=a(d),y=0;y<d;y++)v[y]=Math.max(s[y]/o,1e-100);var m=0,g=[];for(u=0;u<r;u++){var S=new Array(e);for(c=0;c<e;c++)S[c]=0;for(h=0;h<r;h++){m+=-n[u*r+h]*Math.log(v[u*r+h]);var b=4*(i*n[u*r+h]-v[u*r+h])*s[u*r+h];for(c=0;c<e;c++)S[c]+=b*(t[u][c]-t[h][c])}g.push(S)}return{cost:m,grad:g}}},t.tSNE=l}(n),function(r){"use strict";"undefined"===typeof t.exports?window.tsnejs=r:t.exports=r}(n)},function(t,r,e){"use strict";function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}e.r(r);var i=e(0),s=function(){function t(r,e){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.tsne=null,this.numSteps=0,this.costThreshold=0,this.pointsRange=void 0,this.currentStep=0,this.currentCost=Number.MAX_VALUE,this.currentY=[],this.xData=[],this.tsne=new i.tSNE({epsilon:r.epsilon,perplexity:r.perplexity}),this.numSteps=r.numSteps,this.costThreshold=r.costThreshold,this.pointsRange=r.pointsRange,this.xData=e}var r,e,s;return r=t,(e=[{key:"normalizePoints",value:function(t){var r=[],e=[];t.forEach((function(t){r.push(t[0]),e.push(t[1])}));var n=Math.min.apply(null,r),i=Math.max.apply(null,r),s=Math.min.apply(null,e),o=Math.max.apply(null,e),a=this.pointsRange,u=a.x,h=a.y;return t.map((function(t){return[(u[1]-u[0])*((t[0]-n)/(i-n))+u[0],(h[1]-h[0])*((t[1]-s)/(o-s))+h[0]]}))}},{key:"getStepResult",value:function(){if(!this.currentY.length)return{currentStep:this.currentStep,currentCost:this.currentCost,points:[]};for(var t=[],r=0;r<this.currentY.length;r++)t.push({rowId:this.xData[r],xCoord:this.currentY[r][0],yCoord:this.currentY[r][1]});return{currentStep:this.currentStep,currentCost:this.currentCost,points:t}}},{key:"isIterationsEnded",value:function(){return this.currentStep>=this.numSteps||this.currentCost<=this.costThreshold}},{key:"initTsne",value:function(t){return this.tsne.initDataRaw(t),this.currentY=this.normalizePoints(this.tsne.Y),this.getStepResult()}},{key:"runStep",value:function(){return this.isIterationsEnded()||(this.currentStep+=1,this.currentCost=this.tsne.step(),this.currentY=this.normalizePoints(this.tsne.Y)),this.getStepResult()}}])&&n(r.prototype,e),s&&n(r,s),Object.defineProperty(r,"prototype",{writable:!1}),t}();self.addEventListener("message",(function(t){var r=t.data.params,e=t.data.xData,n=t.data.dfData,i=new s(r,e),o=i.initTsne(n);if(postMessage({result:o}),!(o.currentCost<=r.costThreshold))for(var a=0;a<r.numSteps;a++){var u=i.runStep();if(postMessage({result:u}),u.currentCost<=r.costThreshold)break}}))}]);
//# sourceMappingURL=runTsne.worker.f4604769.worker.js.map