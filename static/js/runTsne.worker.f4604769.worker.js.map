{"version":3,"sources":["../webpack/bootstrap","lib/tsne.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","tsneWrapper/TsneWrapper.ts","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","runTsne.worker.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","tsnejs","REVISION","global","assert","condition","message","getopt","opt","field","defaultval","return_v","v_val","gaussRandom","u","Math","random","v","sqrt","log","randn","mu","std","zeros","isNaN","ArrayBuffer","arr","Array","Float64Array","randn2d","uses","x","xhere","j","push","L2","x1","x2","D","length","x1i","x2i","d2p","perplexity","tol","Nf","N","floor","Htarget","P","prow","betamin","Infinity","betamax","beta","done","num","psum","pj","exp","Hhere","abs","Pout","N2","max","sign","tSNE","this","dim","epsilon","iter","initDataRaw","X","dists","dist","xtod","initSolution","initDataDist","Y","gains","ystep","getSolution","step","cg","costGrad","cost","grad","ymean","gid","sid","gainid","newgain","newsid","debugGrad","e","yold","cg0","cg1","analytic","numerical","console","pmul","Qu","qsum","dsum","dhere","qu","NN","Q","q","gsum","premult","lib","window","_defineProperties","target","props","descriptor","configurable","writable","TsneWrapper","params","xData","instance","Constructor","TypeError","tsne","numSteps","costThreshold","pointsRange","currentStep","currentCost","Number","MAX_VALUE","currentY","tsneJs","protoProps","staticProps","points","xPoints","yPoints","forEach","point","minX","min","apply","maxX","minY","maxY","xRanges","yRanges","y","map","rowId","xCoord","yCoord","data","normalizePoints","getStepResult","isIterationsEnded","self","addEventListener","event","tsneParams","dfData","tsneWrapper","initStepResult","initTsne","postMessage","result","currentStepResult","runStep"],"mappings":"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","file":"static/js/runTsne.worker.f4604769.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/t-sne-visualization-tool/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","// create main global object\nvar tsnejs = tsnejs || { REVISION: 'ALPHA' };\n\n(function(global) {\n  \"use strict\";\n\n  // utility function\n  var assert = function(condition, message) {\n    if (!condition) { throw message || \"Assertion failed\"; }\n  }\n\n  // syntax sugar\n  var getopt = function(opt, field, defaultval) {\n    if(opt.hasOwnProperty(field)) {\n      return opt[field];\n    } else {\n      return defaultval;\n    }\n  }\n\n  // return 0 mean unit standard deviation random number\n  var return_v = false;\n  var v_val = 0.0;\n  var gaussRandom = function() {\n    if(return_v) { \n      return_v = false;\n      return v_val; \n    }\n    var u = 2*Math.random()-1;\n    var v = 2*Math.random()-1;\n    var r = u*u + v*v;\n    if(r == 0 || r > 1) return gaussRandom();\n    var c = Math.sqrt(-2*Math.log(r)/r);\n    v_val = v*c; // cache this for next function call for efficiency\n    return_v = true;\n    return u*c;\n  }\n\n  // return random normal number\n  var randn = function(mu, std){ return mu+gaussRandom()*std; }\n\n  // utilitity that creates contiguous vector of zeros of size n\n  var zeros = function(n) {\n    if(typeof(n)==='undefined' || isNaN(n)) { return []; }\n    if(typeof ArrayBuffer === 'undefined') {\n      // lacking browser support\n      var arr = new Array(n);\n      for(var i=0;i<n;i++) { arr[i]= 0; }\n      return arr;\n    } else {\n      return new Float64Array(n); // typed arrays are faster\n    }\n  }\n\n  // utility that returns 2d array filled with random numbers\n  // or with value s, if provided\n  var randn2d = function(n,d,s) {\n    var uses = typeof s !== 'undefined';\n    var x = [];\n    for(var i=0;i<n;i++) {\n      var xhere = [];\n      for(var j=0;j<d;j++) { \n        if(uses) {\n          xhere.push(s); \n        } else {\n          xhere.push(randn(0.0, 1e-4)); \n        }\n      }\n      x.push(xhere);\n    }\n    return x;\n  }\n\n  // compute L2 distance between two vectors\n  var L2 = function(x1, x2) {\n    var D = x1.length;\n    var d = 0;\n    for(var i=0;i<D;i++) { \n      var x1i = x1[i];\n      var x2i = x2[i];\n      d += (x1i-x2i)*(x1i-x2i);\n    }\n    return d;\n  }\n\n  // compute pairwise distance in all vectors in X\n  var xtod = function(X) {\n    var N = X.length;\n    var dist = zeros(N * N); // allocate contiguous array\n    for(var i=0;i<N;i++) {\n      for(var j=i+1;j<N;j++) {\n        var d = L2(X[i], X[j]);\n        dist[i*N+j] = d;\n        dist[j*N+i] = d;\n      }\n    }\n    return dist;\n  }\n\n  // compute (p_{i|j} + p_{j|i})/(2n)\n  var d2p = function(D, perplexity, tol) {\n    var Nf = Math.sqrt(D.length); // this better be an integer\n    var N = Math.floor(Nf);\n    assert(N === Nf, \"D should have square number of elements.\");\n    var Htarget = Math.log(perplexity); // target entropy of distribution\n    var P = zeros(N * N); // temporary probability matrix\n\n    var prow = zeros(N); // a temporary storage compartment\n    for(var i=0;i<N;i++) {\n      var betamin = -Infinity;\n      var betamax = Infinity;\n      var beta = 1; // initial value of precision\n      var done = false;\n      var maxtries = 50;\n\n      // perform binary search to find a suitable precision beta\n      // so that the entropy of the distribution is appropriate\n      var num = 0;\n      while(!done) {\n        //debugger;\n\n        // compute entropy and kernel row with beta precision\n        var psum = 0.0;\n        for(var j=0;j<N;j++) {\n          var pj = Math.exp(- D[i*N+j] * beta);\n          if(i===j) { pj = 0; } // we dont care about diagonals\n          prow[j] = pj;\n          psum += pj;\n        }\n        // normalize p and compute entropy\n        var Hhere = 0.0;\n        for(var j=0;j<N;j++) {\n          if(psum == 0) {\n             var pj = 0;\n          } else {\n             var pj = prow[j] / psum;\n          }\n          prow[j] = pj;\n          if(pj > 1e-7) Hhere -= pj * Math.log(pj);\n        }\n\n        // adjust beta based on result\n        if(Hhere > Htarget) {\n          // entropy was too high (distribution too diffuse)\n          // so we need to increase the precision for more peaky distribution\n          betamin = beta; // move up the bounds\n          if(betamax === Infinity) { beta = beta * 2; }\n          else { beta = (beta + betamax) / 2; }\n\n        } else {\n          // converse case. make distrubtion less peaky\n          betamax = beta;\n          if(betamin === -Infinity) { beta = beta / 2; }\n          else { beta = (beta + betamin) / 2; }\n        }\n\n        // stopping conditions: too many tries or got a good precision\n        num++;\n        if(Math.abs(Hhere - Htarget) < tol) { done = true; }\n        if(num >= maxtries) { done = true; }\n      }\n\n      // console.log('data point ' + i + ' gets precision ' + beta + ' after ' + num + ' binary search steps.');\n      // copy over the final prow to P at row i\n      for(var j=0;j<N;j++) { P[i*N+j] = prow[j]; }\n\n    } // end loop over examples i\n\n    // symmetrize P and normalize it to sum to 1 over all ij\n    var Pout = zeros(N * N);\n    var N2 = N*2;\n    for(var i=0;i<N;i++) {\n      for(var j=0;j<N;j++) {\n        Pout[i*N+j] = Math.max((P[i*N+j] + P[j*N+i])/N2, 1e-100);\n      }\n    }\n\n    return Pout;\n  }\n\n  // helper function\n  function sign(x) { return x > 0 ? 1 : x < 0 ? -1 : 0; }\n\n  var tSNE = function(opt) {\n    var opt = opt || {};\n    this.perplexity = getopt(opt, \"perplexity\", 30); // effective number of nearest neighbors\n    this.dim = getopt(opt, \"dim\", 2); // by default 2-D tSNE\n    this.epsilon = getopt(opt, \"epsilon\", 10); // learning rate\n\n    this.iter = 0;\n  }\n\n  tSNE.prototype = {\n\n    // this function takes a set of high-dimensional points\n    // and creates matrix P from them using gaussian kernel\n    initDataRaw: function(X) {\n      var N = X.length;\n      var D = X[0].length;\n      assert(N > 0, \" X is empty? You must have some data!\");\n      assert(D > 0, \" X[0] is empty? Where is the data?\");\n      var dists = xtod(X); // convert X to distances using gaussian kernel\n      this.P = d2p(dists, this.perplexity, 1e-4); // attach to object\n      this.N = N; // back up the size of the dataset\n      this.initSolution(); // refresh this\n    },\n\n    // this function takes a given distance matrix and creates\n    // matrix P from them.\n    // D is assumed to be provided as a list of lists, and should be symmetric\n    initDataDist: function(D) {\n      var N = D.length;\n      assert(N > 0, \" X is empty? You must have some data!\");\n      // convert D to a (fast) typed array version\n      var dists = zeros(N * N); // allocate contiguous array\n      for(var i=0;i<N;i++) {\n        for(var j=i+1;j<N;j++) {\n          var d = D[i][j];\n          dists[i*N+j] = d;\n          dists[j*N+i] = d;\n        }\n      }\n      this.P = d2p(dists, this.perplexity, 1e-4);\n      this.N = N;\n      this.initSolution(); // refresh this\n    },\n\n    // (re)initializes the solution to random\n    initSolution: function() {\n      // generate random solution to t-SNE\n      this.Y = randn2d(this.N, this.dim); // the solution\n      this.gains = randn2d(this.N, this.dim, 1.0); // step gains to accelerate progress in unchanging directions\n      this.ystep = randn2d(this.N, this.dim, 0.0); // momentum accumulator\n      this.iter = 0;\n    },\n\n    // return pointer to current solution\n    getSolution: function() {\n      return this.Y;\n    },\n\n    // perform a single step of optimization to improve the embedding\n    step: function() {\n      this.iter += 1;\n      var N = this.N;\n\n      var cg = this.costGrad(this.Y); // evaluate gradient\n      var cost = cg.cost;\n      var grad = cg.grad;\n\n      // perform gradient step\n      var ymean = zeros(this.dim);\n      for(var i=0;i<N;i++) {\n        for(var d=0;d<this.dim;d++) {\n          var gid = grad[i][d];\n          var sid = this.ystep[i][d];\n          var gainid = this.gains[i][d];\n\n          // compute gain update\n          var newgain = sign(gid) === sign(sid) ? gainid * 0.8 : gainid + 0.2;\n          if(newgain < 0.01) newgain = 0.01; // clamp\n          this.gains[i][d] = newgain; // store for next turn\n\n          // compute momentum step direction\n          var momval = this.iter < 250 ? 0.5 : 0.8;\n          var newsid = momval * sid - this.epsilon * newgain * grad[i][d];\n          this.ystep[i][d] = newsid; // remember the step we took\n\n          // step!\n          this.Y[i][d] += newsid; \n\n          ymean[d] += this.Y[i][d]; // accumulate mean so that we can center later\n        }\n      }\n\n      // reproject Y to be zero mean\n      for(var i=0;i<N;i++) {\n        for(var d=0;d<this.dim;d++) {\n          this.Y[i][d] -= ymean[d]/N;\n        }\n      }\n\n      //if(this.iter%100===0) console.log('iter ' + this.iter + ', cost: ' + cost);\n      return cost; // return current cost\n    },\n\n    // for debugging: gradient check\n    debugGrad: function() {\n      var N = this.N;\n\n      var cg = this.costGrad(this.Y); // evaluate gradient\n      var cost = cg.cost;\n      var grad = cg.grad;\n\n      var e = 1e-5;\n      for(var i=0;i<N;i++) {\n        for(var d=0;d<this.dim;d++) {\n          var yold = this.Y[i][d];\n\n          this.Y[i][d] = yold + e;\n          var cg0 = this.costGrad(this.Y);\n\n          this.Y[i][d] = yold - e;\n          var cg1 = this.costGrad(this.Y);\n          \n          var analytic = grad[i][d];\n          var numerical = (cg0.cost - cg1.cost) / ( 2 * e );\n          console.log(i + ',' + d + ': gradcheck analytic: ' + analytic + ' vs. numerical: ' + numerical);\n\n          this.Y[i][d] = yold;\n        }\n      }\n    },\n\n    // return cost and gradient, given an arrangement\n    costGrad: function(Y) {\n      var N = this.N;\n      var dim = this.dim; // dim of output space\n      var P = this.P;\n\n      var pmul = this.iter < 100 ? 4 : 1; // trick that helps with local optima\n\n      // compute current Q distribution, unnormalized first\n      var Qu = zeros(N * N);\n      var qsum = 0.0;\n      for(var i=0;i<N;i++) {\n        for(var j=i+1;j<N;j++) {\n          var dsum = 0.0;\n          for(var d=0;d<dim;d++) {\n            var dhere = Y[i][d] - Y[j][d];\n            dsum += dhere * dhere;\n          }\n          var qu = 1.0 / (1.0 + dsum); // Student t-distribution\n          Qu[i*N+j] = qu;\n          Qu[j*N+i] = qu;\n          qsum += 2 * qu;\n        }\n      }\n      // normalize Q distribution to sum to 1\n      var NN = N*N;\n      var Q = zeros(NN);\n      for(var q=0;q<NN;q++) { Q[q] = Math.max(Qu[q] / qsum, 1e-100); }\n\n      var cost = 0.0;\n      var grad = [];\n      for(var i=0;i<N;i++) {\n        var gsum = new Array(dim); // init grad for point i\n        for(var d=0;d<dim;d++) { gsum[d] = 0.0; }\n        for(var j=0;j<N;j++) {\n          cost += - P[i*N+j] * Math.log(Q[i*N+j]); // accumulate cost (the non-constant portion at least...)\n          var premult = 4 * (pmul * P[i*N+j] - Q[i*N+j]) * Qu[i*N+j];\n          for(var d=0;d<dim;d++) {\n            gsum[d] += premult * (Y[i][d] - Y[j][d]);\n          }\n        }\n        grad.push(gsum);\n      }\n\n      return {cost: cost, grad: grad};\n    }\n  }\n\n  global.tSNE = tSNE; // export tSNE class\n})(tsnejs);\n\n\n// export the library to window, or to module in nodejs\n(function(lib) {\n  \"use strict\";\n  if (typeof module === \"undefined\" || typeof module.exports === \"undefined\") {\n    window.tsnejs = lib; // in ordinary browser attach library to window\n  } else {\n    module.exports = lib; // in nodejs\n  }\n})(tsnejs);\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import * as tsneJs from \"../lib/tsne\";\n\nexport interface IPointsRange {\n  x: [number, number],\n  y: [number, number],\n};\n\nexport interface ITsneParams {\n  epsilon: number,\n  perplexity: number,\n  numSteps: number,\n  costThreshold: number,\n  pointsRange: IPointsRange\n};\n\nexport type IDataRow = number[];\n\nexport interface ITsneResultRow {\n  rowId: number,\n  xCoord: number,\n  yCoord: number,\n}\n\nexport interface ITsneStepResult {\n  currentStep: number,\n  currentCost: number,\n  points: ITsneResultRow[],\n}\n\nexport class TsneWrapper {\n  private tsne: any = null;\n\n  private numSteps: number = 0;\n  private costThreshold: number = 0;\n  private pointsRange: IPointsRange;\n\n  private currentStep: number = 0;\n  private currentCost: number = Number.MAX_VALUE;\n  private currentY: IDataRow[] = [];\n\n  private xData: number[] = [];\n\n  constructor(params: ITsneParams, xData: number[]) {\n    this.tsne = new tsneJs.tSNE({\n      epsilon: params.epsilon,\n      perplexity: params.perplexity,\n    });\n\n    this.numSteps = params.numSteps;\n    this.costThreshold = params.costThreshold;\n    this.pointsRange = params.pointsRange;\n\n    this.xData = xData;\n  }\n\n  private normalizePoints(points: IDataRow[]): IDataRow[] {\n    const xPoints: number[] = [];\n    const yPoints: number[] = [];\n\n    points.forEach((point: number[]) => {\n      xPoints.push(point[0]);\n      yPoints.push(point[1]);\n    });\n\n    const minX: number = Math.min.apply(null, xPoints);\n    const maxX: number = Math.max.apply(null, xPoints);\n    const minY: number = Math.min.apply(null, yPoints);\n    const maxY: number = Math.max.apply(null, yPoints);\n\n    const { x: xRanges, y: yRanges } = this.pointsRange;\n\n    return points.map((point: number[]) => {\n      const normX: number = (xRanges[1] - xRanges[0]) * ((point[0] - minX) / (maxX - minX)) + xRanges[0];\n      const normY: number = (yRanges[1] - yRanges[0]) * ((point[1] - minY) / (maxY - minY)) + yRanges[0];\n\n      return [normX, normY];\n    });\n  }\n\n  private getStepResult(): ITsneStepResult {\n    if (!this.currentY.length) {\n      return {\n        currentStep: this.currentStep,\n        currentCost: this.currentCost,\n        points: [],\n      };\n    }\n\n    const points: ITsneResultRow[] = [];\n    for (let i = 0; i < this.currentY.length; i++) {\n      points.push({\n        rowId: this.xData[i],\n        xCoord: (this.currentY[i][0] as number),\n        yCoord: (this.currentY[i][1] as number),\n      });\n    }\n\n    return {\n      currentStep: this.currentStep,\n      currentCost: this.currentCost,\n      points,\n    };\n  }\n\n  private isIterationsEnded(): boolean {\n    return (\n      this.currentStep >= this.numSteps ||\n      this.currentCost <= this.costThreshold\n    );\n  }\n\n  public initTsne(data: IDataRow[]): ITsneStepResult {\n    this.tsne.initDataRaw(data);\n    this.currentY = this.normalizePoints(this.tsne.Y);\n    return this.getStepResult();\n  }\n\n  public runStep(): ITsneStepResult {\n    if (this.isIterationsEnded()) {\n      return this.getStepResult();\n    }\n\n    this.currentStep += 1;\n    this.currentCost = this.tsne.step();\n    this.currentY = this.normalizePoints(this.tsne.Y);\n\n    return this.getStepResult();\n  }\n}\n","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","import {\n  ITsneParams,\n  IDataRow,\n  ITsneStepResult,\n  TsneWrapper,\n} from \"./tsneWrapper/TsneWrapper\";\n\n// eslint-disable-next-line no-restricted-globals\nconst ctx: Worker = self as any;\n\nctx.addEventListener('message', (event) => {\n  const tsneParams = event.data.params as ITsneParams;\n  const xData = event.data.xData as number[];\n  const dfData = event.data.dfData as IDataRow[];\n\n  const tsneWrapper = new TsneWrapper(tsneParams, xData);\n  const initStepResult: ITsneStepResult = tsneWrapper.initTsne(dfData);\n  postMessage({ result: initStepResult });\n\n  if (initStepResult.currentCost <= tsneParams.costThreshold) {\n    return;\n  }\n\n  for (let i = 0; i < tsneParams.numSteps; i++) {\n    const currentStepResult: ITsneStepResult = tsneWrapper.runStep();\n    postMessage({ result: currentStepResult });\n\n    if (currentStepResult.currentCost <= tsneParams.costThreshold) {\n      break;\n    }\n  }\n});\n\nexport {};\n"],"sourceRoot":""}